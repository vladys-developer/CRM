import{j as e}from"./query-CI96NRWO.js";import{k as b,f as v,r as i}from"./vendor-CfbYkwfL.js";import{f as N,c as d,a as r}from"./index-B8FM5hie.js";import{a as y,c as _,C as w}from"./CompanyFormModal-ZXCI9-PE.js";import{$ as C,B as k,a0 as A,N as E,n as F,P as R,aa as B,d as S,U as T,f as n,b as M,T as P}from"./ui-BbExp1x0.js";import"./supabase-BZ0N5lZN.js";const D={prospecto:{label:"Prospecto",color:"#3B82F6"},cliente_activo:{label:"Cliente Activo",color:"#10B981"},cliente_inactivo:{label:"Inactivo",color:"#94A3B8"},ex_cliente:{label:"Ex-Cliente",color:"#EF4444"},partner:{label:"Partner",color:"#8B5CF6"}};function V(){const{id:m}=b(),o=v(),{data:s,isLoading:x}=y(m),u=_(),[p,c]=i.useState(!1),[t,h]=i.useState("overview");if(x)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-8 w-40 animate-pulse rounded bg-muted"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx("div",{className:"h-44 animate-pulse rounded-xl bg-muted"}),e.jsx("div",{className:"h-60 animate-pulse rounded-xl bg-muted"})]}),e.jsx("div",{className:"h-80 animate-pulse rounded-xl bg-muted"})]})]});if(!s)return e.jsxs("div",{className:"flex h-[60vh] flex-col items-center justify-center",children:[e.jsx("p",{className:"text-lg font-medium text-foreground",children:"Empresa no encontrada"}),e.jsx("button",{onClick:()=>o("/companies"),className:"mt-4 text-sm text-primary hover:text-primary/80",children:"Volver a empresas"})]});const l=D[s.status],f=s.commercial_name||s.legal_name,g=async()=>{window.confirm("¿Estás seguro de eliminar esta empresa?")&&(await u.mutateAsync(s.id),o("/companies"))},j=[{id:"overview",label:"Resumen"},{id:"contacts",label:"Contactos"},{id:"opportunities",label:"Oportunidades"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:()=>o("/companies"),className:"inline-flex items-center gap-2 text-sm text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(C,{className:"h-4 w-4"}),"Empresas"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"rounded-xl border border-border bg-card p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-2xl bg-purple-500/10 text-xl font-bold text-purple-500",children:e.jsx(k,{className:"h-8 w-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:f}),s.commercial_name&&s.legal_name!==s.commercial_name&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.legal_name}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[l&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-xs font-medium",style:{backgroundColor:`${l.color}15`,color:l.color},children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full",style:{backgroundColor:l.color}}),l.label]}),s.type&&e.jsx("span",{className:"rounded-full bg-muted px-2 py-0.5 text-xs font-medium text-muted-foreground",children:s.type}),s.tier&&e.jsx("span",{className:"rounded-full bg-amber-500/10 px-2 py-0.5 text-xs font-medium text-amber-600",children:s.tier.charAt(0).toUpperCase()+s.tier.slice(1)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>c(!0),className:"flex h-9 items-center gap-2 rounded-lg border border-input px-3 text-sm font-medium transition-colors hover:bg-accent",children:[e.jsx(A,{className:"h-3.5 w-3.5"}),"Editar"]}),e.jsx("button",{onClick:g,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-input text-destructive transition-colors hover:bg-destructive/10",children:e.jsx(E,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-4 sm:grid-cols-4",children:[s.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(F,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"truncate",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(R,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{children:s.phone})]}),s.website&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(B,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"truncate",children:s.website})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(S,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{children:N(s.created_at)})]})]})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-card",children:[e.jsx("div",{className:"flex border-b border-border px-4",children:j.map(a=>e.jsxs("button",{onClick:()=>h(a.id),className:d("relative px-4 py-3 text-sm font-medium transition-colors",t===a.id?"text-primary":"text-muted-foreground hover:text-foreground"),children:[a.label,t===a.id&&e.jsx("span",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]},a.id))}),e.jsxs("div",{className:"p-6",children:[t==="overview"&&e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{label:"Razón Social",value:s.legal_name},{label:"Nombre Comercial",value:s.commercial_name},{label:"CIF/NIF",value:s.nif_cif},{label:"Industria",value:s.industry},{label:"Subsector",value:s.subsector},{label:"Empleados",value:s.employee_range},{label:"Año Fundación",value:s.founded_year?.toString()},{label:"Territorio",value:s.territory},{label:"Facturación Anual",value:s.annual_revenue?r(s.annual_revenue):null}].map(a=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:a.label}),e.jsx("p",{className:"mt-0.5 text-sm text-foreground",children:a.value??e.jsx("span",{className:"text-muted-foreground/50",children:"—"})})]},a.label))}),t==="contacts"&&e.jsxs("div",{className:"flex flex-col items-center py-12",children:[e.jsx("div",{className:"rounded-full bg-muted p-3",children:e.jsx(T,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("p",{className:"mt-3 text-sm font-medium text-foreground",children:"Sin contactos vinculados"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Los contactos de esta empresa aparecerán aquí"})]}),t==="opportunities"&&e.jsxs("div",{className:"flex flex-col items-center py-12",children:[e.jsx("div",{className:"rounded-full bg-muted p-3",children:e.jsx(n,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("p",{className:"mt-3 text-sm font-medium text-foreground",children:"Sin oportunidades"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Las oportunidades de esta empresa aparecerán aquí"})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-xl border border-border bg-card p-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Métricas Financieras"}),e.jsx("div",{className:"mt-4 space-y-4",children:[{label:"ARR",value:r(s.arr),icon:M,color:"text-blue-500"},{label:"MRR",value:r(s.mrr),icon:P,color:"text-emerald-500"},{label:"LTV",value:r(s.ltv),icon:n,color:"text-purple-500"},{label:"Deals Cerrados",value:r(s.total_closed_deals),icon:n,color:"text-amber-500"}].map(a=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a.icon,{className:d("h-4 w-4",a.color)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.label})]}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:a.value})]},a.label))})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-card p-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Churn Risk"}),e.jsxs("div",{className:"mt-4 flex flex-col items-center",children:[e.jsxs("div",{className:"relative h-28 w-28",children:[e.jsxs("svg",{className:"h-full w-full -rotate-90",viewBox:"0 0 120 120",children:[e.jsx("circle",{cx:"60",cy:"60",r:"50",fill:"none",stroke:"hsl(var(--muted))",strokeWidth:"8"}),e.jsx("circle",{cx:"60",cy:"60",r:"50",fill:"none",stroke:s.churn_risk_score>60?"#EF4444":s.churn_risk_score>30?"#F59E0B":"#10B981",strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${s.churn_risk_score/100*314}`,className:"transition-all duration-700"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-foreground",children:s.churn_risk_score})})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:s.churn_risk_score>60?"Riesgo Alto":s.churn_risk_score>30?"Riesgo Medio":"Riesgo Bajo"})]})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-card p-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Oportunidades Activas"}),e.jsx("p",{className:"mt-2 text-3xl font-bold text-foreground",children:r(s.active_opportunities_value)}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"en pipeline activo"})]})]})]}),p&&e.jsx(w,{company:s,onClose:()=>c(!1)})]})}export{V as CompanyDetailPage};
