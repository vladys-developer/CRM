import{j as e}from"./query-CI96NRWO.js";import{f as B,r}from"./vendor-CfbYkwfL.js";import{a as I,f as R,c as T}from"./index-B8FM5hie.js";import{u as z,g as O,C as D,b as L}from"./CompanyFormModal-ZXCI9-PE.js";import{I as $,b as G,c as Q}from"./ImportExportModal-lMJnKxik.js";import{H as U,J as j,g as Y,B as N,n as H,P as J,a4 as X,a as q,C as K}from"./ui-BbExp1x0.js";import"./supabase-BZ0N5lZN.js";const y={prospecto:{label:"Prospecto",color:"#3B82F6"},cliente_activo:{label:"Cliente Activo",color:"#10B981"},cliente_inactivo:{label:"Inactivo",color:"#94A3B8"},ex_cliente:{label:"Ex-Cliente",color:"#EF4444"},partner:{label:"Partner",color:"#8B5CF6"}},V={platinum:{label:"Platinum",color:"#E5E7EB"},gold:{label:"Gold",color:"#F59E0B"},silver:{label:"Silver",color:"#9CA3AF"},bronze:{label:"Bronze",color:"#CD7F32"}};function le(){const v=B(),[a,d]=r.useState(1),[i,w]=r.useState(""),[x,C]=r.useState(""),[k,m]=r.useState(!1),[S,g]=r.useState(!1),[E,P]=r.useState([]),[o,f]=r.useState(new Set),_=r.useMemo(()=>({search:i||void 0,status:x||void 0}),[i,x]),{data:p,isLoading:A}=z(_,{page:a,pageSize:25,sortBy:"created_at",sortOrder:"desc"}),l=p?.data??[],c=p?.totalPages??1,b=p?.count??0,M=t=>{const s=new Set(o);s.has(t)?s.delete(t):s.add(t),f(s)},F=()=>{f(o.size===l.length?new Set:new Set(l.map(t=>t.id)))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-foreground",children:"Empresas"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Gestiona tu cartera de empresas"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:async()=>{const t=await O();P(t),g(!0)},className:"inline-flex items-center gap-2 rounded-lg border border-input px-4 py-2.5 text-sm font-medium text-foreground transition-colors hover:bg-accent",children:[e.jsx(U,{className:"h-4 w-4"}),"Importar / Exportar"]}),e.jsxs("button",{onClick:()=>m(!0),className:"inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90",children:[e.jsx(j,{className:"h-4 w-4"}),"Nueva Empresa"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 rounded-xl border border-border bg-card p-4 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Buscar por nombre, CIF o email...",value:i,onChange:t=>{w(t.target.value),d(1)},className:"h-9 w-full rounded-lg border border-input bg-background pl-9 pr-4 text-sm outline-none placeholder:text-muted-foreground focus:border-primary focus:ring-1 focus:ring-primary/30"})]}),e.jsxs("select",{value:x,onChange:t=>{C(t.target.value),d(1)},className:"h-9 rounded-lg border border-input bg-background px-3 text-sm outline-none focus:border-primary",children:[e.jsx("option",{value:"",children:"Todos los estados"}),Object.entries(y).map(([t,s])=>e.jsx("option",{value:t,children:s.label},t))]})]}),e.jsxs("div",{className:"overflow-hidden rounded-xl border border-border bg-card",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-muted/50",children:[e.jsx("th",{className:"w-10 px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:l.length>0&&o.size===l.length,onChange:F,className:"h-4 w-4 rounded border-input"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"Empresa"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"Contacto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"Tier"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"ARR"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"Creada"}),e.jsx("th",{className:"w-10 px-4 py-3"})]})}),e.jsx("tbody",{children:A?Array.from({length:5}).map((t,s)=>e.jsx("tr",{className:"border-b border-border",children:Array.from({length:9}).map((n,u)=>e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 w-20 animate-pulse rounded bg-muted"})},u))},s)):l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-16 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"rounded-full bg-muted p-4",children:e.jsx(N,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"mt-4 text-sm font-semibold text-foreground",children:"No hay empresas"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Crea tu primera empresa para empezar"}),e.jsxs("button",{onClick:()=>m(!0),className:"mt-4 inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90",children:[e.jsx(j,{className:"h-4 w-4"}),"Nueva Empresa"]})]})})}):l.map(t=>{const s=y[t.status],n=t.tier?V[t.tier]:null,u=t.commercial_name||t.legal_name;return e.jsxs("tr",{onClick:()=>v(`/companies/${t.id}`),className:T("cursor-pointer border-b border-border transition-colors hover:bg-muted/50",o.has(t.id)&&"bg-primary/5"),children:[e.jsx("td",{className:"px-4 py-3",onClick:h=>h.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:o.has(t.id),onChange:()=>M(t.id),className:"h-4 w-4 rounded border-input"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-lg bg-purple-500/10",children:e.jsx(N,{className:"h-4 w-4 text-purple-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:u}),t.industry&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.industry})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"space-y-1",children:[t.email&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(H,{className:"h-3 w-3"}),t.email]}),t.phone&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(J,{className:"h-3 w-3"}),t.phone]})]})}),e.jsx("td",{className:"px-4 py-3",children:s&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-xs font-medium",style:{backgroundColor:`${s.color}15`,color:s.color},children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full",style:{backgroundColor:s.color}}),s.label]})}),e.jsx("td",{className:"px-4 py-3",children:n&&e.jsx("span",{className:"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium",style:{backgroundColor:`${n.color}20`,color:n.color},children:n.label})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm font-medium text-foreground",children:I(t.arr)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:t.type??"â€”"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:R(t.created_at)}),e.jsx("td",{className:"px-4 py-3",onClick:h=>h.stopPropagation(),children:e.jsx("button",{className:"rounded-lg p-1.5 text-muted-foreground opacity-0 transition-all hover:bg-accent [tr:hover_&]:opacity-100",children:e.jsx(X,{className:"h-4 w-4"})})})]},t.id)})})]})}),c>1&&e.jsxs("div",{className:"flex items-center justify-between border-t border-border px-4 py-3",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(a-1)*25+1,"-",Math.min(a*25,b)," de ",b]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>d(t=>Math.max(1,t-1)),disabled:a===1,className:"flex h-8 w-8 items-center justify-center rounded-lg border border-input text-sm disabled:opacity-50 hover:bg-accent",children:e.jsx(q,{className:"h-4 w-4"})}),e.jsxs("span",{className:"px-3 text-sm font-medium",children:[a," / ",c]}),e.jsx("button",{onClick:()=>d(t=>Math.min(c,t+1)),disabled:a===c,className:"flex h-8 w-8 items-center justify-center rounded-lg border border-input text-sm disabled:opacity-50 hover:bg-accent",children:e.jsx(K,{className:"h-4 w-4"})})]})]})]}),k&&e.jsx(D,{onClose:()=>m(!1)}),S&&e.jsx($,{entityType:"companies",entityLabel:"Empresas",fields:Q,exportColumns:G,exportData:E,onImport:async t=>L(t),onClose:()=>g(!1)})]})}export{le as CompaniesPage};
