import{u as v,j as e}from"./query-CI96NRWO.js";import{s as o,c}from"./index-Dy3KKWzm.js";import{d as _,C as f,m as x,T as L,r as O,s as R,t as G,u as U,Y as E,v as I,w as $,x as F,y as q,z as w,D as W,U as A,n as K,P,F as V,G as Y,B as z,f as J,Z as Q}from"./ui-BbExp1x0.js";import{f as B}from"./vendor-CfbYkwfL.js";import"./supabase-BZ0N5lZN.js";async function Z(){const a=new Date,s=new Date(a.getFullYear(),a.getMonth(),1).toISOString(),r=new Date(a.getFullYear(),a.getMonth()-1,1).toISOString(),n=new Date(a.getFullYear(),a.getMonth(),0).toISOString(),{data:l}=await o.from("opportunities").select("value").in("status",["abierta","open"]),h=l?.reduce((D,M)=>D+(M.value||0),0)??0,g=l?.length??0,{count:t}=await o.from("opportunities").select("*",{count:"exact",head:!0}).gte("created_at",r).lt("created_at",n),i=t?Math.round((g-(t??0))/Math.max(t??1,1)*100):0,{count:m}=await o.from("contacts").select("*",{count:"exact",head:!0}),{count:p}=await o.from("contacts").select("*",{count:"exact",head:!0}).lt("created_at",s),u=p?Math.round(((m??0)-p)/Math.max(p,1)*100):0,{count:y}=await o.from("activities").select("*",{count:"exact",head:!0}).in("status",["pendiente","en_progreso"]),{count:S}=await o.from("activities").select("*",{count:"exact",head:!0}).in("status",["pendiente","en_progreso"]).lt("due_date",a.toISOString()),{count:b}=await o.from("opportunities").select("*",{count:"exact",head:!0}).eq("status","ganada").gte("updated_at",s),{count:j}=await o.from("opportunities").select("*",{count:"exact",head:!0}).eq("status","perdida").gte("updated_at",s),N=(b??0)+(j??0),T=N>0?Math.round((b??0)/N*100):0;return{pipelineTotal:h,pipelineChange:0,openOpportunities:g,opportunitiesChange:i,totalContacts:m??0,contactsChange:u,pendingActivities:y??0,overdueActivities:S??0,winRate:T,wonThisMonth:b??0,lostThisMonth:j??0}}async function X(a=8){const{data:s,error:r}=await o.from("activities").select("id, type, title, related_to_type, status, created_at, priority").order("created_at",{ascending:!1}).limit(a);if(r)throw r;return s??[]}async function H(a=5){const s=new Date().toISOString(),{data:r,error:n}=await o.from("activities").select("id, title, type, due_date, priority, status").in("status",["pendiente","en_progreso"]).gte("due_date",s).order("due_date",{ascending:!0}).limit(a);if(n)throw n;return r??[]}const d={all:["dashboard"],stats:()=>[...d.all,"stats"],funnel:()=>[...d.all,"funnel"],recentActivities:()=>[...d.all,"recentActivities"],upcomingTasks:()=>[...d.all,"upcomingTasks"]};function ee(){return v({queryKey:d.stats(),queryFn:Z,refetchInterval:6e4})}function te(a=8){return v({queryKey:[...d.recentActivities(),a],queryFn:()=>X(a),refetchInterval:3e4})}function ae(a=5){return v({queryKey:[...d.upcomingTasks(),a],queryFn:()=>H(a),refetchInterval:3e4})}const se=[{date:"01 AUG",value:12e5},{date:"07 AUG",value:145e4},{date:"14 AUG",value:18e5},{date:"21 AUG",value:24e5},{date:"28 AUG",value:29e5},{date:"30 AUG",value:3240850}],re={tarea:V,llamada:P,email:K,reunion:A,nota:W},ne={tarea:"text-blue-500 bg-blue-50",llamada:"text-emerald-500 bg-emerald-50",email:"text-purple-500 bg-purple-50",reunion:"text-amber-500 bg-amber-50",nota:"text-pink-500 bg-pink-50"},k={alta:"bg-red-500",media:"bg-amber-500",baja:"bg-emerald-500"};function C(a){return`$${a.toLocaleString("en-US",{minimumFractionDigits:2})}`}function xe(){const a=B(),{data:s}=ee(),{data:r,isLoading:n}=te(),{data:l,isLoading:h}=ae(),g=[{label:"LEADS GENERATED",value:s?.totalContacts??840,color:"bg-emerald-500"},{label:"PROPOSALS SENT",value:s?.openOpportunities??412,color:"bg-blue-500"},{label:"DEALS CLOSED",value:(s?.wonThisMonth??0)+(s?.lostThisMonth??0)||156,color:"bg-indigo-500"}];return e.jsxs("div",{className:"space-y-6 max-w-[1400px]",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"Sales Intelligence"}),e.jsx("p",{className:"text-sm font-medium text-gray-500 mt-1",children:"Real-time revenue and lead performance dashboard"})]}),e.jsxs("button",{className:"flex items-center gap-2 rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition-colors hover:bg-gray-50",children:[e.jsx(_,{className:"h-4 w-4 text-gray-400"}),"Last 30 Days",e.jsx(f,{className:"h-3 w-3 text-gray-400 rotate-90"})]})]}),e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-xl border border-gray-100 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-bold uppercase tracking-[0.15em] text-gray-400 mb-2",children:"Total Revenue Growth"}),e.jsx("p",{className:"text-4xl font-bold tracking-tight text-gray-900",children:s?C(s.pipelineTotal||3240850):"$3,240,850.00"}),e.jsx("div",{className:"flex items-center gap-1.5 mt-2",children:e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 border border-emerald-100 px-2.5 py-0.5 text-xs font-semibold text-emerald-700",children:[e.jsx(L,{className:"h-3 w-3"}),"+24.5% vs last month"]})})]}),e.jsxs("div",{className:"flex items-center gap-1 rounded-lg bg-gray-100 p-0.5",children:[e.jsx("button",{className:"rounded-md px-3 py-1 text-xs font-medium text-gray-500 transition-colors hover:text-gray-700",children:"Monthly"}),e.jsx("button",{className:"rounded-md bg-gray-900 px-3 py-1 text-xs font-semibold text-white shadow-sm",children:"Weekly"})]})]}),e.jsx(O,{width:"100%",height:260,children:e.jsxs(R,{data:se,margin:{top:10,right:10,left:10,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"revenueGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#10b981",stopOpacity:.15}),e.jsx("stop",{offset:"100%",stopColor:"#10b981",stopOpacity:0})]})}),e.jsx(G,{vertical:!1,stroke:"#f3f4f6",strokeDasharray:"4 4"}),e.jsx(U,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fontSize:11,fill:"#9ca3af",fontWeight:500}}),e.jsx(E,{hide:!0}),e.jsx(I,{formatter:t=>[C(Number(t)),"Revenue"],contentStyle:{backgroundColor:"#1a1f36",border:"none",borderRadius:"8px",fontSize:"12px",color:"#fff",boxShadow:"0 10px 30px rgba(0,0,0,0.2)"},itemStyle:{color:"#10b981",fontWeight:600},labelStyle:{color:"#94a3b8"}}),e.jsx($,{type:"monotone",dataKey:"value",stroke:"#10b981",strokeWidth:2.5,fill:"url(#revenueGradient)",dot:{r:4,fill:"#10b981",stroke:"#fff",strokeWidth:2},activeDot:{r:6,fill:"#10b981",stroke:"#fff",strokeWidth:3}})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"lg:col-span-2 rounded-xl border border-gray-100 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold tracking-tight text-gray-900",children:"Recent Leads"}),e.jsx("p",{className:"text-sm text-gray-400 mt-0.5",children:"Incoming opportunities from all channels"})]}),e.jsxs("button",{onClick:()=>a("/contacts"),className:"flex items-center gap-1.5 text-xs font-semibold text-gray-500 hover:text-emerald-600 transition-colors",children:["View Full List",e.jsx(F,{className:"h-3 w-3"})]})]}),e.jsxs("div",{className:"grid grid-cols-[2fr_1.5fr_1fr_1fr] gap-4 border-b border-gray-100 pb-3 mb-2",children:[e.jsx("span",{className:"text-[11px] font-bold uppercase tracking-[0.1em] text-gray-400",children:"Contact"}),e.jsx("span",{className:"text-[11px] font-bold uppercase tracking-[0.1em] text-gray-400",children:"Company"}),e.jsx("span",{className:"text-[11px] font-bold uppercase tracking-[0.1em] text-gray-400",children:"Source"}),e.jsx("span",{className:"text-[11px] font-bold uppercase tracking-[0.1em] text-gray-400 text-right",children:"Estimated Value"})]}),n?e.jsx("div",{className:"space-y-4 py-4",children:Array.from({length:3}).map((t,i)=>e.jsx("div",{className:"h-12 animate-pulse rounded-lg bg-gray-50"},i))}):e.jsx("div",{className:"divide-y divide-gray-50",children:[{name:"Sarah Jenkins",email:"s.jenkins@vortex.co",company:"Vortex Systems",companyColor:"bg-purple-500",source:"Direct Mail",sourceColor:"bg-blue-50 text-blue-700 border-blue-100",value:"$42,500"},{name:"Marcus Thorne",email:"m.thorne@lumina.io",company:"Lumina Global",companyColor:"bg-emerald-500",source:"Organic Search",sourceColor:"bg-emerald-50 text-emerald-700 border-emerald-100",value:"$18,200"},{name:"Elena Vogt",email:"e.vogt@nexis.com",company:"Nexis Corp",companyColor:"bg-amber-500",source:"Referral",sourceColor:"bg-amber-50 text-amber-700 border-amber-100",value:"$65,000"},{name:"James Chen",email:"j.chen@atlas.dev",company:"Atlas Dev",companyColor:"bg-indigo-500",source:"LinkedIn",sourceColor:"bg-indigo-50 text-indigo-700 border-indigo-100",value:"$28,750"}].map((t,i)=>e.jsxs("div",{className:"grid grid-cols-[2fr_1.5fr_1fr_1fr] gap-4 items-center py-3.5 hover:bg-gray-50/50 -mx-2 px-2 rounded-lg transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-gray-100 text-xs font-semibold text-gray-600",children:t.name.split(" ").map(m=>m[0]).join("")}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-xs text-gray-400",children:t.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:c("flex h-6 w-6 shrink-0 items-center justify-center rounded text-[10px] font-bold text-white",t.companyColor),children:t.company.charAt(0)}),e.jsx("span",{className:"text-sm text-gray-700",children:t.company})]}),e.jsx("span",{className:c("inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-semibold",t.sourceColor),children:t.source}),e.jsx("span",{className:"text-sm font-semibold text-gray-900 text-right",children:t.value})]},i))})]}),e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"rounded-xl border border-gray-100 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-bold tracking-tight text-gray-900 mb-6",children:"Conversion Funnel"}),e.jsx("div",{className:"space-y-5",children:g.map(t=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-[11px] font-bold uppercase tracking-[0.1em] text-gray-400",children:t.label}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:t.value})]}),e.jsx("div",{className:"h-2 w-full rounded-full bg-gray-100 overflow-hidden",children:e.jsx(x.div,{initial:{width:0},animate:{width:`${t.value/(g[0]?.value||1)*100}%`},transition:{duration:1,delay:.5,ease:"easeOut"},className:c("h-full rounded-full",t.color)})})]},t.label))}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-100",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Current Q4 Win Rate"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-3xl font-bold text-gray-900",children:[s?.winRate??18.5,"%"]}),e.jsxs("span",{className:"flex items-center gap-0.5 text-xs font-semibold text-emerald-600",children:[e.jsx(q,{className:"h-3 w-3"}),"+2.1%"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg bg-gray-50 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold text-gray-900",children:s?.wonThisMonth??42}),e.jsx("p",{className:"text-[11px] font-medium text-gray-400",children:"Won"})]}),e.jsxs("div",{className:"rounded-lg bg-gray-50 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold text-gray-900",children:s?.lostThisMonth??8}),e.jsx("p",{className:"text-[11px] font-medium text-gray-400",children:"Lost"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.25},className:"lg:col-span-2 rounded-xl border border-gray-100 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h2",{className:"text-lg font-bold tracking-tight text-gray-900",children:"Recent Activity"}),e.jsxs("button",{onClick:()=>a("/activities"),className:"flex items-center gap-1 text-xs font-semibold text-gray-400 hover:text-emerald-600 transition-colors",children:["View all ",e.jsx(f,{className:"h-3 w-3"})]})]}),n?e.jsx("div",{className:"space-y-4",children:Array.from({length:4}).map((t,i)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 animate-pulse rounded-full bg-gray-50"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 w-1/3 animate-pulse rounded bg-gray-50"}),e.jsx("div",{className:"h-2 w-1/4 animate-pulse rounded bg-gray-50"})]})]},i))}):(r?.length??0)===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[e.jsx("div",{className:"rounded-full bg-gray-50 p-4 mb-3",children:e.jsx(w,{className:"h-6 w-6 opacity-40"})}),e.jsx("p",{className:"text-sm font-medium",children:"No activity yet"})]}):e.jsx("div",{className:"space-y-1",children:r?.map(t=>{const i=re[t.type]??w,m=ne[t.type]??"text-gray-500 bg-gray-50",[p="text-gray-500",u="bg-gray-50"]=m.split(" "),y=ie(t.created_at);return e.jsxs("div",{className:"group flex items-center gap-4 rounded-lg px-3 py-3 transition-all hover:bg-gray-50 cursor-pointer",onClick:()=>a("/activities"),children:[e.jsx("div",{className:c("flex h-10 w-10 items-center justify-center rounded-full",u),children:e.jsx(i,{className:c("h-5 w-5",p)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.title}),e.jsxs("p",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx("span",{className:"capitalize",children:t.status.replace("_"," ")}),e.jsx("span",{children:"â€¢"}),y]})]}),e.jsx("div",{className:c("h-2 w-2 rounded-full",k[t.priority]??"bg-gray-300")}),e.jsx(f,{className:"h-4 w-4 text-gray-300 transition-transform group-hover:translate-x-1 group-hover:text-emerald-500"})]},t.id)})})]}),e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"rounded-xl border border-gray-100 bg-white p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-900 flex items-center gap-2 mb-4",children:[e.jsx(Y,{className:"h-4 w-4 text-emerald-500"}),"Upcoming Tasks"]}),h?e.jsx("div",{className:"space-y-2",children:Array.from({length:3}).map((t,i)=>e.jsx("div",{className:"h-12 animate-pulse rounded-lg bg-gray-50"},i))}):(l?.length??0)===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-full min-h-[100px] text-gray-400",children:e.jsx("p",{className:"text-xs",children:"No upcoming tasks"})}):e.jsx("div",{className:"space-y-2",children:l?.map(t=>e.jsxs("div",{className:"flex items-center gap-3 rounded-lg bg-gray-50 px-3 py-2.5 hover:bg-gray-100 transition-all cursor-pointer",onClick:()=>a("/activities"),children:[e.jsx("div",{className:c("h-2 w-2 rounded-full shrink-0",k[t.priority]??"bg-gray-300")}),e.jsx("span",{className:"flex-1 truncate text-xs font-medium text-gray-700",children:t.title}),e.jsx("div",{className:"rounded-md px-1.5 py-0.5 bg-white text-[10px] text-gray-500 whitespace-nowrap border border-gray-100",children:new Date(t.due_date).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit"})})]},t.id))}),e.jsxs("div",{className:"mt-6 pt-5 border-t border-gray-100",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 mb-3",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{icon:A,label:"Contact",path:"/contacts",color:"text-blue-500 bg-blue-50"},{icon:z,label:"Company",path:"/companies",color:"text-purple-500 bg-purple-50"},{icon:J,label:"Deal",path:"/opportunities",color:"text-emerald-500 bg-emerald-50"},{icon:Q,label:"Activity",path:"/activities",color:"text-amber-500 bg-amber-50"}].map(t=>e.jsxs("button",{onClick:()=>a(t.path),className:"flex flex-col items-center justify-center gap-1.5 rounded-lg border border-gray-100 p-3 text-center transition-all hover:-translate-y-0.5 hover:shadow-md hover:border-emerald-200 bg-white",children:[e.jsx("div",{className:c("p-1.5 rounded-lg",t.color),children:e.jsx(t.icon,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-[11px] font-medium text-gray-600",children:t.label})]},t.label))})]})]})]})]})}function ie(a){const s=Date.now()-new Date(a).getTime(),r=Math.floor(s/6e4);if(r<1)return"Just now";if(r<60)return`${r}m ago`;const n=Math.floor(r/60);if(n<24)return`${n}h ago`;const l=Math.floor(n/24);return l<7?`${l}d ago`:new Date(a).toLocaleDateString("es-ES",{day:"numeric",month:"short"})}export{xe as DashboardPage};
