import{j as e}from"./query-CI96NRWO.js";import{r}from"./vendor-CfbYkwfL.js";import{u as se,a as oe,b as le,c as ne,d as ie}from"./useActivities-oCmPWo5X.js";import{A as de,m as G,X as ce,F as R,P as J,n as V,U as Z,D as K,ab as ue,ac as Q,d as W,G as $,j as me,B as xe,f as pe,J as X,ad as be,g as ge,ae as he,af as Y,ag as ee,ah as fe,a4 as je,a as ve,C as ye}from"./ui-BbExp1x0.js";import{c as y}from"./index-Dy3KKWzm.js";import"./supabase-BZ0N5lZN.js";const Ne=[{value:"tarea",label:"Tarea",icon:R,color:"bg-blue-500"},{value:"llamada",label:"Llamada",icon:J,color:"bg-green-500"},{value:"email",label:"Email",icon:V,color:"bg-purple-500"},{value:"reunion",label:"Reunión",icon:Z,color:"bg-amber-500"},{value:"nota",label:"Nota",icon:K,color:"bg-pink-500"}],we=[{value:"alta",label:"Alta",color:"text-red-500"},{value:"media",label:"Media",color:"text-amber-500"},{value:"baja",label:"Baja",color:"text-green-500"}],Ce=[{value:"pendiente",label:"Pendiente"},{value:"en_progreso",label:"En Progreso"},{value:"completada",label:"Completada"},{value:"cancelada",label:"Cancelada"},{value:"pospuesta",label:"Pospuesta"}],ke=[{value:"contact",label:"Contacto",icon:me},{value:"company",label:"Empresa",icon:xe},{value:"opportunity",label:"Oportunidad",icon:pe}];function Se({isOpen:m,onClose:g,onSubmit:N,activity:s,loading:w=!1,defaultType:P="tarea",defaultRelatedTo:d}){const D=!!s,[l,n]=r.useState(P),[_,i]=r.useState(""),[h,x]=r.useState(""),[T,c]=r.useState("media"),[O,C]=r.useState("pendiente"),[I,k]=r.useState(""),[S,F]=r.useState(""),[L,A]=r.useState(d?.type??""),[f,p]=r.useState(d?.id??"");r.useEffect(()=>{s?(n(s.type),i(s.title),x(s.description??""),c(s.priority),C(s.status),k(s.due_date?s.due_date.slice(0,16):""),F(s.duration_minutes?.toString()??""),A(s.related_to_type??""),p(s.related_to_id??"")):(n(P),i(""),x(""),c("media"),C("pendiente"),k(""),F(""),A(d?.type??""),p(d?.id??""))},[s,m,P,d]),r.useEffect(()=>{const a=u=>{u.key==="Escape"&&g()};return m&&window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[m,g]);const B=a=>{a.preventDefault();const u={type:l,title:_,description:h||void 0,priority:T,status:O,due_date:I?new Date(I).toISOString():void 0,duration_minutes:S?parseInt(S):void 0,related_to_type:L||void 0,related_to_id:f||void 0};N(u)};return e.jsx(de,{children:m&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx(G.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:g}),e.jsxs(G.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2},className:"relative z-10 w-full max-w-lg max-h-[90vh] overflow-y-auto rounded-2xl border border-border bg-card p-6 shadow-2xl mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:D?"Editar Actividad":"Nueva Actividad"}),e.jsx("button",{onClick:g,className:"rounded-lg p-2 text-muted-foreground hover:bg-accent transition-colors",children:e.jsx(ce,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:B,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-foreground",children:"Tipo"}),e.jsx("div",{className:"flex gap-2",children:Ne.map(a=>{const u=a.icon,b=l===a.value;return e.jsxs("button",{type:"button",onClick:()=>n(a.value),className:`flex flex-1 flex-col items-center gap-1.5 rounded-xl border-2 p-3 text-xs font-medium transition-all ${b?"border-primary bg-primary/10 text-primary":"border-border bg-background text-muted-foreground hover:border-primary/30"}`,children:[e.jsx("div",{className:`rounded-lg p-1.5 ${b?a.color:"bg-muted"}`,children:e.jsx(u,{className:`h-4 w-4 ${b?"text-white":"text-muted-foreground"}`})}),a.label]},a.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-medium text-foreground",children:"Título *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx("input",{type:"text",value:_,onChange:a=>i(a.target.value),placeholder:l==="llamada"?"Llamar a cliente...":l==="reunion"?"Reunión con...":"Título de la actividad",className:"h-11 w-full rounded-xl border border-input bg-background pl-10 pr-4 text-sm outline-none transition-all placeholder:text-muted-foreground focus:border-primary focus:ring-2 focus:ring-primary/20",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-medium text-foreground",children:"Descripción"}),e.jsx("textarea",{value:h,onChange:a=>x(a.target.value),placeholder:"Detalles adicionales...",rows:3,className:"w-full rounded-xl border border-input bg-background px-4 py-3 text-sm outline-none transition-all placeholder:text-muted-foreground focus:border-primary focus:ring-2 focus:ring-primary/20 resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1.5 flex items-center gap-1.5 text-sm font-medium text-foreground",children:[e.jsx(Q,{className:"h-3.5 w-3.5"})," Prioridad"]}),e.jsx("select",{value:T,onChange:a=>c(a.target.value),className:"h-11 w-full rounded-xl border border-input bg-background px-3 text-sm outline-none transition-all focus:border-primary focus:ring-2 focus:ring-primary/20",children:we.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),D&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-medium text-foreground",children:"Estado"}),e.jsx("select",{value:O,onChange:a=>C(a.target.value),className:"h-11 w-full rounded-xl border border-input bg-background px-3 text-sm outline-none transition-all focus:border-primary focus:ring-2 focus:ring-primary/20",children:Ce.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1.5 flex items-center gap-1.5 text-sm font-medium text-foreground",children:[e.jsx(W,{className:"h-3.5 w-3.5"})," Fecha límite"]}),e.jsx("input",{type:"datetime-local",value:I,onChange:a=>k(a.target.value),className:"h-11 w-full rounded-xl border border-input bg-background px-3 text-sm outline-none transition-all focus:border-primary focus:ring-2 focus:ring-primary/20"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1.5 flex items-center gap-1.5 text-sm font-medium text-foreground",children:[e.jsx($,{className:"h-3.5 w-3.5"})," Duración (min)"]}),e.jsx("input",{type:"number",value:S,onChange:a=>F(a.target.value),placeholder:"30",min:"0",className:"h-11 w-full rounded-xl border border-input bg-background px-3 text-sm outline-none transition-all placeholder:text-muted-foreground focus:border-primary focus:ring-2 focus:ring-primary/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-medium text-foreground",children:"Relacionado con"}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-2",children:ke.map(a=>{const u=a.icon,b=L===a.value;return e.jsxs("button",{type:"button",onClick:()=>A(b?"":a.value),className:`flex items-center gap-2 rounded-lg border px-3 py-2 text-xs font-medium transition-all ${b?"border-primary bg-primary/10 text-primary":"border-border text-muted-foreground hover:border-primary/30"}`,children:[e.jsx(u,{className:"h-3.5 w-3.5"}),a.label]},a.value)})}),L&&e.jsx("input",{type:"text",value:f,onChange:a=>p(a.target.value),placeholder:"ID del registro relacionado",className:"h-10 w-full rounded-xl border border-input bg-background px-3 text-sm outline-none transition-all placeholder:text-muted-foreground focus:border-primary focus:ring-2 focus:ring-primary/20"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:g,className:"flex-1 h-11 rounded-xl border border-border bg-background font-medium text-foreground transition-all hover:bg-accent",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:w||!_.trim(),className:"flex-1 h-11 rounded-xl bg-primary font-medium text-primary-foreground transition-all hover:bg-primary/90 disabled:opacity-50",children:w?e.jsx("div",{className:"mx-auto h-5 w-5 animate-spin rounded-full border-2 border-primary-foreground border-t-transparent"}):D?"Guardar Cambios":"Crear Actividad"})]})]})]})]})})}const U={tarea:{label:"Tareas",icon:R,color:"text-blue-500",bgColor:"bg-blue-500/10"},llamada:{label:"Llamadas",icon:J,color:"text-green-500",bgColor:"bg-green-500/10"},email:{label:"Emails",icon:V,color:"text-purple-500",bgColor:"bg-purple-500/10"},reunion:{label:"Reuniones",icon:Z,color:"text-amber-500",bgColor:"bg-amber-500/10"},nota:{label:"Notas",icon:K,color:"text-pink-500",bgColor:"bg-pink-500/10"}},q={pendiente:{label:"Pendiente",icon:fe,color:"text-amber-500"},en_progreso:{label:"En Progreso",icon:$,color:"text-blue-500"},completada:{label:"Completada",icon:ee,color:"text-emerald-500"},cancelada:{label:"Cancelada",icon:Y,color:"text-red-500"},pospuesta:{label:"Pospuesta",icon:he,color:"text-gray-500"}},H={alta:{label:"Alta",color:"text-red-500",dotColor:"bg-red-500"},media:{label:"Media",color:"text-amber-500",dotColor:"bg-amber-500"},baja:{label:"Baja",color:"text-green-500",dotColor:"bg-green-500"}},z=15;function Te(){const[m,g]=r.useState(""),[N,s]=r.useState(""),[w,P]=r.useState(""),[d,D]=r.useState(""),[l,n]=r.useState(1),[_,i]=r.useState(!1),[h,x]=r.useState(null),[T,c]=r.useState(null),O=r.useMemo(()=>({search:m||void 0,type:N||void 0,status:w||void 0,priority:d||void 0,page:l,pageSize:z}),[m,N,w,d,l]),{data:C,isLoading:I}=se(O),k=oe(),S=le(),F=ne(),L=ie(),A=C?.data??[],f=C?.count??0,p=Math.ceil(f/z),B=async t=>{await k.mutateAsync(t),i(!1)},a=async t=>{h&&(await S.mutateAsync({id:h.id,data:t}),x(null),i(!1))},u=async t=>{confirm("¿Eliminar esta actividad?")&&await F.mutateAsync(t),c(null)},b=async t=>{await L.mutateAsync(t),c(null)},te=t=>{if(!t)return"—";const o=new Date(t),j=new Date,v=o.getTime()-j.getTime(),E=Math.ceil(v/(1e3*60*60*24)),M=o.toLocaleDateString("es-ES",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"});return E<0?e.jsx("span",{className:"text-red-500",title:"Vencida",children:M}):E===0?e.jsx("span",{className:"text-amber-500",title:"Hoy",children:M}):E===1?e.jsx("span",{className:"text-blue-500",title:"Mañana",children:M}):e.jsx("span",{children:M})},ae=[{value:"",label:"Todas",count:f},...Object.entries(U).map(([t,o])=>({value:t,label:o.label,count:null}))];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-foreground",children:"Actividades"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Gestiona tareas, llamadas, emails, reuniones y notas"})]}),e.jsxs("button",{onClick:()=>{x(null),i(!0)},className:"flex items-center gap-2 rounded-xl bg-primary px-4 py-2.5 text-sm font-medium text-primary-foreground transition-all hover:bg-primary/90 hover:shadow-lg hover:shadow-primary/25",children:[e.jsx(X,{className:"h-4 w-4"}),"Nueva Actividad"]})]}),e.jsx("div",{className:"flex gap-1 overflow-x-auto rounded-xl border border-border bg-card p-1",children:ae.map(t=>{const j=(t.value?U[t.value]:null)?.icon??be,v=N===t.value;return e.jsxs("button",{onClick:()=>{s(t.value),n(1)},className:y("flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all whitespace-nowrap",v?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground hover:bg-accent hover:text-foreground"),children:[e.jsx(j,{className:"h-4 w-4"}),t.label]},t.value||"all")})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[250px]",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Buscar actividades...",value:m,onChange:t=>{g(t.target.value),n(1)},className:"h-10 w-full rounded-xl border border-input bg-background pl-10 pr-4 text-sm outline-none transition-all placeholder:text-muted-foreground focus:border-primary focus:ring-2 focus:ring-primary/20"})]}),e.jsxs("select",{value:w,onChange:t=>{P(t.target.value),n(1)},className:"h-10 rounded-xl border border-input bg-background px-3 text-sm outline-none transition-all focus:border-primary focus:ring-2 focus:ring-primary/20",children:[e.jsx("option",{value:"",children:"Todo Estado"}),Object.entries(q).map(([t,o])=>e.jsx("option",{value:t,children:o.label},t))]}),e.jsxs("select",{value:d,onChange:t=>{D(t.target.value),n(1)},className:"h-10 rounded-xl border border-input bg-background px-3 text-sm outline-none transition-all focus:border-primary focus:ring-2 focus:ring-primary/20",children:[e.jsx("option",{value:"",children:"Toda Prioridad"}),Object.entries(H).map(([t,o])=>e.jsx("option",{value:t,children:o.label},t))]})]}),e.jsx("div",{className:"rounded-xl border border-border bg-card overflow-hidden",children:I?e.jsx("div",{className:"space-y-0",children:Array.from({length:5}).map((t,o)=>e.jsxs("div",{className:"flex items-center gap-4 border-b border-border/50 px-5 py-4",children:[e.jsx("div",{className:"h-10 w-10 animate-pulse rounded-lg bg-muted"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 w-48 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"h-3 w-32 animate-pulse rounded bg-muted"})]})]},o))}):A.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"rounded-full bg-muted p-4",children:e.jsx(R,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("p",{className:"mt-4 text-sm font-medium text-foreground",children:"Sin actividades"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Crea tu primera actividad para empezar a organizar tu trabajo"}),e.jsxs("button",{onClick:()=>i(!0),className:"mt-4 flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground",children:[e.jsx(X,{className:"h-4 w-4"}),"Crear Actividad"]})]}):e.jsx("div",{children:A.map((t,o)=>{const j=U[t.type],v=q[t.status],E=H[t.priority],M=j.icon,re=v.icon;return e.jsxs(G.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:o*.03},className:y("group flex items-center gap-4 border-b border-border/50 px-5 py-4 transition-colors hover:bg-accent/50",t.status==="completada"&&"opacity-60"),children:[e.jsx("div",{className:y("rounded-lg p-2.5",j.bgColor),children:e.jsx(M,{className:y("h-4 w-4",j.color)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:y("text-sm font-medium text-foreground truncate",t.status==="completada"&&"line-through"),children:t.title}),e.jsx("div",{className:y("h-2 w-2 rounded-full",E.dotColor),title:E.label})]}),t.description&&e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground truncate max-w-md",children:t.description})]}),e.jsxs("div",{className:y("flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs font-medium",v.color,"border-current/20"),children:[e.jsx(re,{className:"h-3 w-3"}),v.label]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground w-36 justify-end",children:[e.jsx(W,{className:"h-3 w-3"}),te(t.due_date)]}),t.duration_minutes&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground w-16 justify-end",children:[e.jsx($,{className:"h-3 w-3"}),t.duration_minutes,"m"]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>c(T===t.id?null:t.id),className:"rounded-lg p-1.5 text-muted-foreground opacity-0 transition-opacity hover:bg-accent group-hover:opacity-100",children:e.jsx(je,{className:"h-4 w-4"})}),T===t.id&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(null)}),e.jsxs("div",{className:"absolute right-0 top-full z-20 mt-1 w-44 rounded-xl border border-border bg-card p-1 shadow-xl",children:[t.status!=="completada"&&e.jsxs("button",{onClick:()=>b(t.id),className:"flex w-full items-center gap-2 rounded-lg px-3 py-2 text-sm text-foreground hover:bg-accent",children:[e.jsx(ee,{className:"h-4 w-4 text-emerald-500"}),"Completar"]}),e.jsxs("button",{onClick:()=>{x(t),i(!0),c(null)},className:"flex w-full items-center gap-2 rounded-lg px-3 py-2 text-sm text-foreground hover:bg-accent",children:[e.jsx(Q,{className:"h-4 w-4"}),"Editar"]}),e.jsxs("button",{onClick:()=>u(t.id),className:"flex w-full items-center gap-2 rounded-lg px-3 py-2 text-sm text-red-500 hover:bg-red-500/10",children:[e.jsx(Y,{className:"h-4 w-4"}),"Eliminar"]})]})]})]})]},t.id)})})}),p>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Mostrando ",(l-1)*z+1,"–",Math.min(l*z,f)," de ",f]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(t=>Math.max(1,t-1)),disabled:l===1,className:"rounded-lg border border-border p-2 text-muted-foreground transition-colors hover:bg-accent disabled:opacity-50",children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[l," / ",p]}),e.jsx("button",{onClick:()=>n(t=>Math.min(p,t+1)),disabled:l===p,className:"rounded-lg border border-border p-2 text-muted-foreground transition-colors hover:bg-accent disabled:opacity-50",children:e.jsx(ye,{className:"h-4 w-4"})})]})]}),e.jsx(Se,{isOpen:_,onClose:()=>{i(!1),x(null)},onSubmit:h?a:B,activity:h,loading:k.isPending||S.isPending,defaultType:N||"tarea"})]})}export{Te as ActivitiesPage};
