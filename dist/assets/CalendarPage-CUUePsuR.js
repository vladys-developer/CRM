import{u as T,j as e}from"./query-CI96NRWO.js";import{f as I,r as u}from"./vendor-CfbYkwfL.js";import{s as O,c as o}from"./index-Dy3KKWzm.js";import{J as D,a as L,C as P,D as z,U as A,n as F,P as H,F as C,d as N,m as K,G as V}from"./ui-BbExp1x0.js";import"./supabase-BZ0N5lZN.js";async function q(n,a){const{data:p,error:i}=await O.from("activities").select("id, title, type, status, priority, due_date, duration_minutes, description, related_to_type, related_to_id").gte("due_date",n).lte("due_date",a).order("due_date",{ascending:!0});if(i)throw i;return(p??[]).map(s=>{const x=s.due_date??new Date().toISOString(),b=(s.duration_minutes??60)*60*1e3,l=new Date(new Date(x).getTime()+b).toISOString();return{id:s.id,title:s.title,type:s.type,status:s.status,priority:s.priority,start:x,end:l,allDay:!s.due_date,description:s.description,related_to_type:s.related_to_type,related_to_id:s.related_to_id}})}const _={all:["calendar"],events:(n,a)=>[..._.all,"events",n,a]};function J(n,a){return T({queryKey:_.events(n,a),queryFn:()=>q(n,a),enabled:!!n&&!!a})}const S={tarea:{icon:C,color:"text-blue-500",bgColor:"bg-blue-500/10",dotColor:"bg-blue-500"},llamada:{icon:H,color:"text-green-500",bgColor:"bg-green-500/10",dotColor:"bg-green-500"},email:{icon:F,color:"text-purple-500",bgColor:"bg-purple-500/10",dotColor:"bg-purple-500"},reunion:{icon:A,color:"text-amber-500",bgColor:"bg-amber-500/10",dotColor:"bg-amber-500"},nota:{icon:z,color:"text-pink-500",bgColor:"bg-pink-500/10",dotColor:"bg-pink-500"}},R=["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"];function X(){const n=I(),[a,p]=u.useState(new Date),[i,s]=u.useState(null),[x,b]=u.useState("month"),l=a.getFullYear(),c=a.getMonth(),{startDate:j,endDate:y}=u.useMemo(()=>{const t=new Date(l,c,1),r=new Date(l,c+1,0,23,59,59),d=t.getDay()===0?6:t.getDay()-1;return t.setDate(t.getDate()-d),r.setDate(r.getDate()+(6-(r.getDay()===0?6:r.getDay()-1))),{startDate:t.toISOString(),endDate:r.toISOString()}},[l,c]),{data:h,isLoading:k}=J(j,y),M=u.useMemo(()=>{const t=[],r=new Date(j),d=new Date;for(d.setHours(0,0,0,0);r<=new Date(y);){const g=r.toISOString().split("T")[0],m=(h??[]).filter(f=>new Date(f.start).toISOString().split("T")[0]===g);t.push({date:new Date(r),isCurrentMonth:r.getMonth()===c,isToday:r.toDateString()===d.toDateString(),events:m}),r.setDate(r.getDate()+1)}return t},[j,y,h,c]),v=u.useMemo(()=>i?(h??[]).filter(t=>new Date(t.start).toISOString().split("T")[0]===i):[],[i,h]),w=t=>{p(new Date(l,c+t,1)),s(null)},E=a.toLocaleDateString("es-ES",{month:"long",year:"numeric"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-foreground",children:"Calendario"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Visualiza tus actividades programadas"})]}),e.jsxs("button",{onClick:()=>n("/activities"),className:"flex items-center gap-2 rounded-xl bg-primary px-4 py-2.5 text-sm font-medium text-primary-foreground transition-all hover:bg-primary/90 hover:shadow-lg hover:shadow-primary/25",children:[e.jsx(D,{className:"h-4 w-4"}),"Nueva Actividad"]})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-border bg-card px-5 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>w(-1),className:"rounded-lg border border-border p-2 text-muted-foreground transition-colors hover:bg-accent",children:e.jsx(L,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-lg font-semibold text-foreground capitalize min-w-[180px] text-center",children:E}),e.jsx("button",{onClick:()=>w(1),className:"rounded-lg border border-border p-2 text-muted-foreground transition-colors hover:bg-accent",children:e.jsx(P,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{p(new Date),s(null)},className:"rounded-lg border border-border px-3 py-1.5 text-sm font-medium text-foreground hover:bg-accent transition-colors",children:"Hoy"}),e.jsxs("div",{className:"flex rounded-lg border border-border overflow-hidden",children:[e.jsx("button",{onClick:()=>b("month"),className:o("px-3 py-1.5 text-sm font-medium transition-colors",x==="month"?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-accent"),children:"Mes"}),e.jsx("button",{onClick:()=>b("week"),className:o("px-3 py-1.5 text-sm font-medium transition-colors",x==="week"?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-accent"),children:"Semana"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-4",children:[e.jsxs("div",{className:"lg:col-span-3 rounded-xl border border-border bg-card overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-7 border-b border-border bg-accent/30",children:R.map(t=>e.jsx("div",{className:"px-3 py-2.5 text-center text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:t},t))}),k?e.jsx("div",{className:"grid grid-cols-7",children:Array.from({length:35}).map((t,r)=>e.jsxs("div",{className:"border-b border-r border-border/50 p-2 h-28",children:[e.jsx("div",{className:"h-5 w-5 animate-pulse rounded bg-muted mb-2"}),e.jsx("div",{className:"h-3 w-full animate-pulse rounded bg-muted"})]},r))}):e.jsx("div",{className:"grid grid-cols-7",children:M.map((t,r)=>{const d=t.date.toISOString().split("T")[0],g=i===d;return e.jsxs("div",{onClick:()=>s(d??null),className:o("relative border-b border-r border-border/50 p-2 h-28 cursor-pointer transition-colors",!t.isCurrentMonth&&"bg-muted/20",g&&"bg-primary/5 ring-2 ring-primary/30 ring-inset",t.isToday&&"bg-primary/5","hover:bg-accent/50"),children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:o("text-sm font-medium",t.isToday?"flex h-7 w-7 items-center justify-center rounded-full bg-primary text-primary-foreground":t.isCurrentMonth?"text-foreground":"text-muted-foreground/50"),children:t.date.getDate()})}),e.jsxs("div",{className:"space-y-0.5",children:[t.events.slice(0,3).map(m=>{const f=S[m.type];return e.jsx("div",{className:o("truncate rounded px-1.5 py-0.5 text-[10px] font-medium leading-tight",f?.bgColor??"bg-muted"),title:m.title,children:e.jsx("span",{className:f?.color??"text-muted-foreground",children:m.title})},m.id)}),t.events.length>3&&e.jsxs("span",{className:"text-[10px] text-muted-foreground pl-1",children:["+",t.events.length-3," más"]})]})]},r)})})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-card p-5",children:[e.jsxs("h3",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4 text-muted-foreground"}),i?new Date(i+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"}):"Selecciona un día"]}),i?v.length===0?e.jsxs("div",{className:"mt-8 flex flex-col items-center text-center",children:[e.jsx(N,{className:"h-8 w-8 text-muted-foreground/30 mb-3"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sin actividades para este día"}),e.jsxs("button",{onClick:()=>n("/activities"),className:"mt-3 flex items-center gap-1 text-xs font-medium text-primary hover:text-primary/80",children:[e.jsx(D,{className:"h-3 w-3"}),"Crear actividad"]})]}):e.jsx("div",{className:"mt-4 space-y-2",children:v.map(t=>{const r=S[t.type],d=r?.icon??C,g=new Date(t.start).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"});return e.jsxs(K.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},className:o("rounded-xl border border-border p-3 transition-all hover:shadow-sm",t.status==="completada"&&"opacity-60"),children:[e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:o("rounded-lg p-2 mt-0.5",r?.bgColor??"bg-muted"),children:e.jsx(d,{className:o("h-3.5 w-3.5",r?.color??"text-muted-foreground")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:o("text-sm font-medium text-foreground truncate",t.status==="completada"&&"line-through"),children:t.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-[11px] text-muted-foreground",children:[e.jsx(V,{className:"h-3 w-3"}),g]}),t.description&&e.jsx("p",{className:"mt-1.5 text-[11px] text-muted-foreground line-clamp-2",children:t.description})]})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("span",{className:o("rounded-full px-2 py-0.5 text-[10px] font-medium",t.status==="completada"?"bg-emerald-500/10 text-emerald-500":t.status==="pendiente"?"bg-amber-500/10 text-amber-500":t.status==="en_progreso"?"bg-blue-500/10 text-blue-500":"bg-muted text-muted-foreground"),children:t.status}),e.jsx("span",{className:o("h-2 w-2 rounded-full",t.priority==="alta"?"bg-red-500":t.priority==="media"?"bg-amber-500":"bg-green-500")})]})]},t.id)})}):e.jsxs("div",{className:"mt-8 flex flex-col items-center text-center",children:[e.jsx(N,{className:"h-10 w-10 text-muted-foreground/30 mb-3"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Haz clic en un día del calendario para ver sus actividades"})]})]})]})]})}export{X as CalendarPage};
