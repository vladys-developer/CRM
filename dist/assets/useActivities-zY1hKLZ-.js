import{u as w,b as r,c as u}from"./query-CI96NRWO.js";import{s as o}from"./index-B8FM5hie.js";async function C(t={}){const{search:e,type:a,status:n,priority:c,related_to_type:l,related_to_id:d,assigned_to:y,page:q=1,pageSize:f=20}=t;let i=o.from("activities").select(`
            *,
            assigned_user:user_profiles!activities_assigned_to_fkey(full_name, avatar_url)
        `,{count:"exact"});e&&(i=i.or(`title.ilike.%${e}%,description.ilike.%${e}%`)),a&&(i=i.eq("type",a)),n&&(i=i.eq("status",n)),c&&(i=i.eq("priority",c)),l&&(i=i.eq("related_to_type",l)),d&&(i=i.eq("related_to_id",d)),y&&(i=i.eq("assigned_to",y));const v=(q-1)*f,m=v+f-1,{data:g,error:p,count:A}=await i.order("due_date",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!1}).range(v,m);if(p)throw p;return{data:g,count:A??0}}async function S(t){const{data:e,error:a}=await o.from("activities").insert(t).select().single();if(a)throw a;return e}async function _(t,e){const{data:a,error:n}=await o.from("activities").update({...e,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(n)throw n;return a}async function F(t){const{error:e}=await o.from("activities").delete().eq("id",t);if(e)throw e}async function K(t){return _(t,{status:"completada"})}const s={all:["activities"],lists:()=>[...s.all,"list"],list:t=>[...s.lists(),t],details:()=>[...s.all,"detail"],detail:t=>[...s.details(),t],counts:()=>[...s.all,"counts"]};function b(t={}){return w({queryKey:s.list(t),queryFn:()=>C(t)})}function k(){const t=r();return u({mutationFn:e=>S(e),onSuccess:()=>{t.invalidateQueries({queryKey:s.all})}})}function x(){const t=r();return u({mutationFn:({id:e,data:a})=>_(e,a),onSuccess:()=>{t.invalidateQueries({queryKey:s.all})}})}function D(){const t=r();return u({mutationFn:e=>F(e),onSuccess:()=>{t.invalidateQueries({queryKey:s.all})}})}function $(){const t=r();return u({mutationFn:e=>K(e),onSuccess:()=>{t.invalidateQueries({queryKey:s.all})}})}export{k as a,x as b,D as c,$ as d,b as u};
