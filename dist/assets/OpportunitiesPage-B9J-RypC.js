import{j as e}from"./query-CI96NRWO.js";import{f as N,r as l}from"./vendor-CfbYkwfL.js";import{a as y,f as v}from"./index-B8FM5hie.js";import{u as w}from"./useOpportunities-BM8L7a44.js";import{J as k,g as _,f as u,a as C,C as S}from"./ui-BbExp1x0.js";import"./supabase-BZ0N5lZN.js";const h={abierto:{label:"Abierto",color:"#3B82F6"},ganado:{label:"Ganado",color:"#10B981"},perdido:{label:"Perdido",color:"#EF4444"},descartado:{label:"Descartado",color:"#94A3B8"}};function F(){N();const[r,a]=l.useState(1),[o,p]=l.useState(""),[n,f]=l.useState(""),g=l.useMemo(()=>({search:o||void 0,status:n||void 0}),[o,n]),{data:c,isLoading:b}=w(g,{page:r,pageSize:25,sortBy:"created_at",sortOrder:"desc"}),i=c?.data??[],d=c?.totalPages??1,m=c?.count??0;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-foreground",children:"Oportunidades"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Gestiona tu pipeline de ventas"})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-sm font-medium text-primary-foreground hover:bg-primary/90",children:[e.jsx(k,{className:"h-4 w-4"}),"Nueva Oportunidad"]})]}),e.jsxs("div",{className:"flex flex-col gap-3 rounded-xl border border-border bg-card p-4 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Buscar oportunidades...",value:o,onChange:t=>{p(t.target.value),a(1)},className:"h-9 w-full rounded-lg border border-input bg-background pl-9 pr-4 text-sm outline-none placeholder:text-muted-foreground focus:border-primary focus:ring-1 focus:ring-primary/30"})]}),e.jsxs("select",{value:n,onChange:t=>{f(t.target.value),a(1)},className:"h-9 rounded-lg border border-input bg-background px-3 text-sm outline-none focus:border-primary",children:[e.jsx("option",{value:"",children:"Todos"}),Object.entries(h).map(([t,s])=>e.jsx("option",{value:t,children:s.label},t))]})]}),e.jsxs("div",{className:"overflow-hidden rounded-xl border border-border bg-card",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-muted/50",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"Oportunidad"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"Empresa"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"Etapa"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"Probabilidad"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"Cierre Est."})]})}),e.jsx("tbody",{children:b?Array.from({length:5}).map((t,s)=>e.jsx("tr",{className:"border-b border-border",children:Array.from({length:7}).map((x,j)=>e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 w-20 animate-pulse rounded bg-muted"})},j))},s)):i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-16 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"rounded-full bg-muted p-4",children:e.jsx(u,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"mt-4 text-sm font-semibold text-foreground",children:"Sin oportunidades"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Crea tu primera oportunidad"})]})})}):i.map(t=>{const s=h[t.status],x=t.company?t.company.commercial_name||t.company.legal_name:"—";return e.jsxs("tr",{className:"cursor-pointer border-b border-border transition-colors hover:bg-muted/50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-lg bg-emerald-500/10",children:e.jsx(u,{className:"h-4 w-4 text-emerald-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:t.name}),t.contact&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.contact.first_name," ",t.contact.last_name]})]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:x}),e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-foreground",children:y(t.monetary_value)}),e.jsx("td",{className:"px-4 py-3",children:t.stage&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-xs font-medium",style:{backgroundColor:`${t.stage.color}15`,color:t.stage.color},children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full",style:{backgroundColor:t.stage.color}}),t.stage.name]})}),e.jsx("td",{className:"px-4 py-3",children:s&&e.jsx("span",{className:"inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-xs font-medium",style:{backgroundColor:`${s.color}15`,color:s.color},children:s.label})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-1.5 w-16 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary/70",style:{width:`${t.close_probability}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.close_probability,"%"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:t.estimated_close_date?v(t.estimated_close_date):"—"})]},t.id)})})]})}),d>1&&e.jsxs("div",{className:"flex items-center justify-between border-t border-border px-4 py-3",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(r-1)*25+1,"-",Math.min(r*25,m)," de ",m]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>a(t=>Math.max(1,t-1)),disabled:r===1,className:"flex h-8 w-8 items-center justify-center rounded-lg border border-input text-sm disabled:opacity-50 hover:bg-accent",children:e.jsx(C,{className:"h-4 w-4"})}),e.jsxs("span",{className:"px-3 text-sm font-medium",children:[r," / ",d]}),e.jsx("button",{onClick:()=>a(t=>Math.min(d,t+1)),disabled:r===d,className:"flex h-8 w-8 items-center justify-center rounded-lg border border-input text-sm disabled:opacity-50 hover:bg-accent",children:e.jsx(S,{className:"h-4 w-4"})})]})]})]})]})}export{F as OpportunitiesPage};
