import{u as C,b as y,c as v,j as a}from"./query-CI96NRWO.js";import{r as _}from"./vendor-CfbYkwfL.js";import{s as u,t as m,u as w}from"./index-Dy3KKWzm.js";import{A as N,m as j,X as E,a3 as S}from"./ui-BbExp1x0.js";async function q(e={},t={page:1,pageSize:25}){const{page:o,pageSize:n,sortBy:c="created_at",sortOrder:i="desc"}=t,r=(o-1)*n,b=r+n-1;let s=u.from("contacts").select("*",{count:"exact"});e.search&&(s=s.or(`first_name.ilike.%${e.search}%,last_name.ilike.%${e.search}%,email.ilike.%${e.search}%,phone_mobile.ilike.%${e.search}%`)),e.status&&(s=s.eq("status",e.status)),e.source&&(s=s.eq("source",e.source)),e.priority&&(s=s.eq("priority",e.priority)),e.owner_id&&(s=s.eq("owner_id",e.owner_id)),e.company_id&&(s=s.eq("company_id",e.company_id)),s=s.order(c,{ascending:i==="asc"}).range(r,b);const{data:g,error:h,count:d}=await s;if(h)throw h;return{data:g??[],count:d??0,page:o,pageSize:n,totalPages:Math.ceil((d??0)/n)}}async function k(e){const{data:t,error:o}=await u.from("contacts").select("*").eq("id",e).single();if(o)throw o;return t}async function F(e){const{data:t,error:o}=await u.from("contacts").insert(e).select().single();if(o)throw o;return t}async function P(e,t){const{data:o,error:n}=await u.from("contacts").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)throw n;return o}async function A(e){const{error:t}=await u.from("contacts").delete().eq("id",e);if(t)throw t}async function R(e){let t=0,o=0;const n=50;for(let c=0;c<e.length;c+=n){const i=e.slice(c,c+n),{error:r,data:b}=await u.from("contacts").insert(i).select("id");r?o+=i.length:t+=b?.length??0}return{success:t,errors:o}}async function $(){const{data:e,error:t}=await u.from("contacts").select("*").order("created_at",{ascending:!1}).limit(1e4);if(t)throw t;return e??[]}const p="contacts";function L(e={},t={page:1,pageSize:25}){return C({queryKey:[p,e,t],queryFn:()=>q(e,t)})}function U(e){return C({queryKey:[p,e],queryFn:()=>k(e),enabled:!!e})}function O(){const e=y();return v({mutationFn:t=>F(t),onSuccess:()=>{e.invalidateQueries({queryKey:[p]}),m.success("Contacto creado correctamente")},onError:t=>{m.error("Error al crear contacto",{description:t.message})}})}function T(){const e=y();return v({mutationFn:({id:t,updates:o})=>P(t,o),onSuccess:t=>{e.invalidateQueries({queryKey:[p]}),e.setQueryData([p,t.id],t),m.success("Contacto actualizado")},onError:t=>{m.error("Error al actualizar contacto",{description:t.message})}})}function W(){const e=y();return v({mutationFn:t=>A(t),onSuccess:()=>{e.invalidateQueries({queryKey:[p]}),m.success("Contacto eliminado")},onError:t=>{m.error("Error al eliminar contacto",{description:t.message})}})}const I=[{value:"nuevo",label:"Nuevo",color:"#3B82F6"},{value:"contactado",label:"Contactado",color:"#8B5CF6"},{value:"calificado",label:"Calificado",color:"#F59E0B"},{value:"cliente",label:"Cliente",color:"#10B981"},{value:"inactivo",label:"Inactivo",color:"#6B7280"},{value:"descartado",label:"Descartado",color:"#EF4444"}],D=[{value:"formulario",label:"Formulario"},{value:"whatsapp",label:"WhatsApp"},{value:"importacion",label:"Importación"},{value:"integracion",label:"Integración"},{value:"referido",label:"Referido"},{value:"evento",label:"Evento"},{value:"web",label:"Web"},{value:"manual",label:"Manual"},{value:"otro",label:"Otro"}],z=[{value:"alta",label:"Alta",color:"#EF4444"},{value:"media",label:"Media",color:"#F59E0B"},{value:"baja",label:"Baja",color:"#10B981"}];function Y({contact:e,onClose:t}){const{profile:o}=w(),n=O(),c=T(),i=!!e,[r,b]=_.useState({first_name:e?.first_name??"",last_name:e?.last_name??"",email:e?.email??"",email_secondary:e?.email_secondary??"",phone_mobile:e?.phone_mobile??"",phone_landline:e?.phone_landline??"",phone_whatsapp:e?.phone_whatsapp??"",job_title:e?.job_title??"",department:e?.department??"",source:e?.source??"directo",status:e?.status??"nuevo",priority:e?.priority??"media",preferred_language:e?.preferred_language??"es",notes:e?.notes??"",address_street:e?.address_street??"",address_city:e?.address_city??"",address_state:e?.address_state??"",address_postal_code:e?.address_postal_code??"",address_country:e?.address_country??"ES"}),s=d=>{b(x=>({...x,[d.target.name]:d.target.value}))},g=async d=>{d.preventDefault();try{i?await c.mutateAsync({id:e.id,updates:r}):await n.mutateAsync({...r,team_id:o?.team_id??"",owner_id:o?.id??""}),t()}catch{}},h=n.isPending||c.isPending;return _.useEffect(()=>{const d=x=>{x.key==="Escape"&&t()};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[t]),a.jsx(N,{children:a.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[a.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:t}),a.jsxs(j.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2},className:"relative z-10 mx-4 max-h-[90vh] w-full max-w-2xl overflow-y-auto rounded-2xl border border-border bg-card shadow-2xl",children:[a.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-border bg-card px-6 py-4",children:[a.jsx("h2",{className:"text-lg font-semibold text-foreground",children:i?"Editar Contacto":"Nuevo Contacto"}),a.jsx("button",{onClick:t,className:"flex h-8 w-8 items-center justify-center rounded-lg text-muted-foreground transition-colors hover:bg-accent",children:a.jsx(E,{className:"h-4 w-4"})})]}),a.jsxs("form",{onSubmit:g,className:"p-6",children:[a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-foreground",children:"Información Personal"}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[a.jsx(l,{label:"Nombre *",name:"first_name",value:r.first_name,onChange:s,required:!0}),a.jsx(l,{label:"Apellido",name:"last_name",value:r.last_name,onChange:s}),a.jsx(l,{label:"Email",name:"email",type:"email",value:r.email,onChange:s}),a.jsx(l,{label:"Email secundario",name:"email_secondary",type:"email",value:r.email_secondary,onChange:s}),a.jsx(l,{label:"Móvil",name:"phone_mobile",value:r.phone_mobile,onChange:s}),a.jsx(l,{label:"Teléfono fijo",name:"phone_landline",value:r.phone_landline,onChange:s}),a.jsx(l,{label:"WhatsApp",name:"phone_whatsapp",value:r.phone_whatsapp,onChange:s})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-foreground",children:"Información Profesional"}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[a.jsx(l,{label:"Cargo",name:"job_title",value:r.job_title,onChange:s}),a.jsx(l,{label:"Departamento",name:"department",value:r.department,onChange:s})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-foreground",children:"Clasificación"}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[a.jsx(f,{label:"Estado",name:"status",value:r.status,onChange:s,options:I}),a.jsx(f,{label:"Fuente",name:"source",value:r.source,onChange:s,options:D}),a.jsx(f,{label:"Prioridad",name:"priority",value:r.priority,onChange:s,options:z})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-foreground",children:"Dirección"}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[a.jsx("div",{className:"sm:col-span-2",children:a.jsx(l,{label:"Calle",name:"address_street",value:r.address_street,onChange:s})}),a.jsx(l,{label:"Ciudad",name:"address_city",value:r.address_city,onChange:s}),a.jsx(l,{label:"Provincia",name:"address_state",value:r.address_state,onChange:s}),a.jsx(l,{label:"Código Postal",name:"address_postal_code",value:r.address_postal_code,onChange:s}),a.jsx(l,{label:"País",name:"address_country",value:r.address_country,onChange:s})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-foreground",children:"Notas"}),a.jsx("textarea",{name:"notes",value:r.notes,onChange:s,rows:3,className:"w-full rounded-lg border border-input bg-background px-3 py-2 text-sm outline-none placeholder:text-muted-foreground focus:border-primary focus:ring-1 focus:ring-primary/30",placeholder:"Notas adicionales..."})]})]}),a.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3 border-t border-border pt-4",children:[a.jsx("button",{type:"button",onClick:t,className:"rounded-lg border border-input px-4 py-2 text-sm font-medium transition-colors hover:bg-accent",children:"Cancelar"}),a.jsxs("button",{type:"submit",disabled:h||!r.first_name,className:"inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:opacity-50",children:[h&&a.jsx(S,{className:"h-4 w-4 animate-spin"}),i?"Guardar Cambios":"Crear Contacto"]})]})]})]})]})})}function l({label:e,name:t,type:o="text",value:n,onChange:c,required:i}){return a.jsxs("div",{children:[a.jsx("label",{className:"mb-1 block text-xs font-medium text-muted-foreground",children:e}),a.jsx("input",{type:o,name:t,value:n,onChange:c,required:i,className:"h-9 w-full rounded-lg border border-input bg-background px-3 text-sm outline-none placeholder:text-muted-foreground focus:border-primary focus:ring-1 focus:ring-primary/30"})]})}function f({label:e,name:t,value:o,onChange:n,options:c}){return a.jsxs("div",{children:[a.jsx("label",{className:"mb-1 block text-xs font-medium text-muted-foreground",children:e}),a.jsx("select",{name:t,value:o,onChange:n,className:"h-9 w-full rounded-lg border border-input bg-background px-3 text-sm outline-none focus:border-primary focus:ring-1 focus:ring-primary/30",children:c.map(i=>a.jsx("option",{value:i.value,children:i.label},i.value))})]})}export{I as C,z as P,W as a,Y as b,R as c,U as d,$ as g,L as u};
